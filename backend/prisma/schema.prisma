generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Clientes {
  id_cliente        Int              @id @default(autoincrement())
  nombre_cliente    String
  apellido_cliente  String
  tipo_documento    String
  numero_documento  String
  direccion_cliente String
  correo_cliente    String
  id_usuario        Int?
  Usuarios          Usuarios?        @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction, map: "id_usuario")
  Documentos_XML    Documentos_XML[]

  @@unique([numero_documento, id_usuario])
}

model Configuraciones_Firmas {
  id_config   Int      @id(map: "id_config")
  ruta        String
  certificado String
  contrasena  String
  metodo      String
  firma       String
  id_usuario  Int
  Usuarios    Usuarios @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction, map: "id_usuario")
}

model Documentos_XML {
  id_documento         Int                @id @default(autoincrement())
  tipo_documento       String
  numero_documento     String
  prefijo              String? 
  fecha_emision        DateTime           @db.Timestamp(6)
  valor_total          Decimal            @db.Decimal(15, 2)
  impuestos            Decimal            @db.Decimal(15, 2)
  estado_dian          String
  codigo_dian          String
  mensaje_dian         String
  fecha_respuesta_dian DateTime           @db.Timestamp(6)
  cufe                 String?
  cude                 String?
  xml_archivo          String
  pdf_archivo          Bytes
  id_cliente           Int?
  factura_relacionada  String?
  id_usuario           Int
  Clientes             Clientes?          @relation(fields: [id_cliente], references: [id_cliente])
  Usuarios             Usuarios           @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction, map: "id_usuario")
  Eventos              Eventos[]
  Producto_Factura     Producto_Factura[]
}

model Eventos {
  id_evento      Int            @id(map: "id_evento")
  tipo_evento    String
  fecha_hora     DateTime       @db.Timestamp(6)
  descripcion    String
  resultado      String
  id_documento   Int
  id_usuario     Int
  Documentos_XML Documentos_XML @relation(fields: [id_documento], references: [id_documento], onDelete: NoAction, onUpdate: NoAction, map: "id_documento")
  Usuarios       Usuarios       @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction, map: "id_usuario")
}

model Producto_Factura {
  id_producto     Int            @id @default(autoincrement())
  descripcion     String
  cantidad        Int
  precio_unitario Float
  iva             Float
  total           Float
  id_documento    Int
  Documentos_XML  Documentos_XML @relation(fields: [id_documento], references: [id_documento])
}

model Usuarios {
  id_usuario                   Int                      @id @default(autoincrement())
  nombre_usuario               String
  rol_usuario                  String?
  contrasena_usuario           String
  nit_empresa                  String
  correo_contacto              String                   @unique
  prefijo_numeracion           Int?
  num_inicial                  Int?
  num_final                    Int?
  certificado_firma            String?
  contrasena_certificado       String?
  token_api                    String?
  fecha_expiracion_certificado DateTime?
  Registros_Sistema            Registros_Sistema[] 
  Clientes                     Clientes[]
  Configuraciones_Firmas       Configuraciones_Firmas[]
  Documentos_XML               Documentos_XML[]
  Eventos                      Eventos[]
  PasswordResetToken           PasswordResetToken[]
  configuracionTecnica         Configuracion_Tecnica?   @relation("UsuarioConfiguracion")
}

model PasswordResetToken {
  id         Int      @id @default(autoincrement())
  token      String   @unique
  id_usuario Int
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  Usuarios   Usuarios @relation(fields: [id_usuario], references: [id_usuario])
}

model codigos_verificacion {
  id              Int      @id @default(autoincrement())
  correo          String
  codigo          String
  contrasena_temp String
  nombre_empresa  String
  nit_empresa     String
  expiracion      DateTime
}

model Configuracion_Tecnica {
  id_configuracion    Int      @id @default(autoincrement())
  direccion_empresa   String
  regimen_tributario  String
  certificado_firma   String
  contrasena_cert     String
  token_api           String
  fecha_expiracion    DateTime
  id_usuario          Int      @unique
  usuario             Usuarios @relation("UsuarioConfiguracion", fields: [id_usuario], references: [id_usuario])
   numeraciones        Json     @default("[]")
}

model Registros_Sistema {
  id_registro       Int       @id @default(autoincrement())
  fecha_hora        DateTime  @default(now())
  id_usuario        Int
  nombre_usuario    String?
  empresa           String?
  tipo_documento    String?
  numero_documento  String?
  accion            String
  resultado         String
  mensaje           String?
  Usuarios          Usuarios  @relation(fields: [id_usuario], references: [id_usuario])

  @@map("Registros_Sistema")
}

